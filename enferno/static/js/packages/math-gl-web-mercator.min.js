if("undefined"==typeof globalThis)var global=globalThis;var process;!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(global=void 0!==t?t:t||self).webMercator=e()}(this,function(){"use strict";const t=1e-6;let e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function i(t,e,n,i){const a=e[0],o=e[1];return t[0]=a+i*(n[0]-a),t[1]=o+i*(n[1]-o),t}const a=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t};!function(){const t=function(){const t=new e(2);return e!=Float32Array&&(t[0]=0,t[1]=0),t}()}();const o=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t};function r(t,e,n){const i=e[0],a=e[1],o=e[2],r=e[3],s=e[4],h=e[5],u=e[6],c=e[7],M=e[8],l=e[9],f=e[10],b=e[11],d=e[12],g=e[13],m=e[14],p=e[15];let x=n[0],w=n[1],P=n[2],F=n[3];return t[0]=x*i+w*s+P*M+F*d,t[1]=x*a+w*h+P*l+F*g,t[2]=x*o+w*u+P*f+F*m,t[3]=x*r+w*c+P*b+F*p,x=n[4],w=n[5],P=n[6],F=n[7],t[4]=x*i+w*s+P*M+F*d,t[5]=x*a+w*h+P*l+F*g,t[6]=x*o+w*u+P*f+F*m,t[7]=x*r+w*c+P*b+F*p,x=n[8],w=n[9],P=n[10],F=n[11],t[8]=x*i+w*s+P*M+F*d,t[9]=x*a+w*h+P*l+F*g,t[10]=x*o+w*u+P*f+F*m,t[11]=x*r+w*c+P*b+F*p,x=n[12],w=n[13],P=n[14],F=n[15],t[12]=x*i+w*s+P*M+F*d,t[13]=x*a+w*h+P*l+F*g,t[14]=x*o+w*u+P*f+F*m,t[15]=x*r+w*c+P*b+F*p,t}function s(t,e,n){const i=n[0],a=n[1],o=n[2];let r,s,h,u,c,M,l,f,b,d,g,m;return e===t?(t[12]=e[0]*i+e[4]*a+e[8]*o+e[12],t[13]=e[1]*i+e[5]*a+e[9]*o+e[13],t[14]=e[2]*i+e[6]*a+e[10]*o+e[14],t[15]=e[3]*i+e[7]*a+e[11]*o+e[15]):(r=e[0],s=e[1],h=e[2],u=e[3],c=e[4],M=e[5],l=e[6],f=e[7],b=e[8],d=e[9],g=e[10],m=e[11],t[0]=r,t[1]=s,t[2]=h,t[3]=u,t[4]=c,t[5]=M,t[6]=l,t[7]=f,t[8]=b,t[9]=d,t[10]=g,t[11]=m,t[12]=r*i+c*a+b*o+e[12],t[13]=s*i+M*a+d*o+e[13],t[14]=h*i+l*a+g*o+e[14],t[15]=u*i+f*a+m*o+e[15]),t}function h(t,e,n){const i=n[0],a=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}!function(){const t=function(){const t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}()}();const u=function(t,e,n,i,a){const o=1/Math.tan(e/2);if(t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0){const e=1/(i-a);t[10]=(a+i)*e,t[14]=2*a*i*e}else t[10]=-1,t[14]=-2*i;return t};function c(e,n){const i=e[0],a=e[1],o=e[2],r=e[3],s=e[4],h=e[5],u=e[6],c=e[7],M=e[8],l=e[9],f=e[10],b=e[11],d=e[12],g=e[13],m=e[14],p=e[15],x=n[0],w=n[1],P=n[2],F=n[3],v=n[4],j=n[5],y=n[6],N=n[7],L=n[8],z=n[9],T=n[10],Z=n[11],S=n[12],A=n[13],D=n[14],B=n[15];return Math.abs(i-x)<=t*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-w)<=t*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-P)<=t*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(r-F)<=t*Math.max(1,Math.abs(r),Math.abs(F))&&Math.abs(s-v)<=t*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(h-j)<=t*Math.max(1,Math.abs(h),Math.abs(j))&&Math.abs(u-y)<=t*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(c-N)<=t*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(M-L)<=t*Math.max(1,Math.abs(M),Math.abs(L))&&Math.abs(l-z)<=t*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(f-T)<=t*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(b-Z)<=t*Math.max(1,Math.abs(b),Math.abs(Z))&&Math.abs(d-S)<=t*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(g-A)<=t*Math.max(1,Math.abs(g),Math.abs(A))&&Math.abs(m-D)<=t*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(p-B)<=t*Math.max(1,Math.abs(p),Math.abs(B))}function M(t,e){const n=function(t,e,n){const i=e[0],a=e[1],o=e[2],r=e[3];return t[0]=n[0]*i+n[4]*a+n[8]*o+n[12]*r,t[1]=n[1]*i+n[5]*a+n[9]*o+n[13]*r,t[2]=n[2]*i+n[6]*a+n[10]*o+n[14]*r,t[3]=n[3]*i+n[7]*a+n[11]*o+n[15]*r,t}([],e,t);var i,a,o;return i=n,a=n,o=1/n[3],i[0]=a[0]*o,i[1]=a[1]*o,i[2]=a[2]*o,i[3]=a[3]*o,n}function l(t,e){const n=t%e;return n<0?e+n:n}function f(t,e,n){return n*e+(1-n)*t}function b(t,e,n){return t<e?e:t>n?n:t}!function(){const t=function(){const t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();const d=Math.log2||function(t){return Math.log(t)*Math.LOG2E};function g(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const m=Math.PI,p=m/4,x=m/180,w=180/m,P=512,F=4003e4,v=85.051129,j=1.5;function y(t){return Math.pow(2,t)}function N(t){return d(t)}function L(t){const[e,n]=t;g(Number.isFinite(e)),g(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*x;return[P*(e*x+m)/(2*m),P*(m+Math.log(Math.tan(p+.5*i)))/(2*m)]}function z(t){const[e,n]=t,i=e/P*(2*m)-m,a=2*(Math.atan(Math.exp(n/P*(2*m)-m))-p);return[i*w,a*w]}function T(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;g(Number.isFinite(e)&&Number.isFinite(n));const a=P,o=Math.cos(e*x),r=a/360,s=r/o,h=12790407194604047e-21/o,u={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[r,s,h],degreesPerUnit:[.703125,1/s,1/h]};if(i){const t=x*Math.tan(e*x)/o,n=r*t/2,i=12790407194604047e-21*t,a=i/s*h;u.unitsPerDegree2=[0,n,i],u.unitsPerMeter2=[a,0,a]}return u}function Z(t){const{height:e,pitch:n,bearing:i,altitude:a,scale:o,center:r}=t,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];s(u,u,[0,0,-a]),function(t,e,n){const i=Math.sin(n),a=Math.cos(n),o=e[4],r=e[5],s=e[6],h=e[7],u=e[8],c=e[9],M=e[10],l=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*a+u*i,t[5]=r*a+c*i,t[6]=s*a+M*i,t[7]=h*a+l*i,t[8]=u*a-o*i,t[9]=c*a-r*i,t[10]=M*a-s*i,t[11]=l*a-h*i}(u,u,-n*x),function(t,e,n){const i=Math.sin(n),a=Math.cos(n),o=e[0],r=e[1],s=e[2],h=e[3],u=e[4],c=e[5],M=e[6],l=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a+u*i,t[1]=r*a+c*i,t[2]=s*a+M*i,t[3]=h*a+l*i,t[4]=u*a-o*i,t[5]=c*a-r*i,t[6]=M*a-s*i,t[7]=l*a-h*i}(u,u,i*x);const c=o/e;var M,l;return h(u,u,[c,c,c]),r&&s(u,u,((M=[])[0]=-(l=r)[0],M[1]=-l[1],M[2]=-l[2],M)),u}function S(t){const{width:e,height:n,altitude:i,pitch:a=0,offset:o,center:r,scale:s,nearZMultiplier:h=1,farZMultiplier:u=1}=t;let{fovy:c=D(j)}=t;void 0!==i&&(c=D(i));const M=c*x,l=a*x,f=B(c);let d=f;r&&(d+=r[2]*s/Math.cos(l)/n);const g=M*(.5+(o?o[1]:0)/n),m=Math.sin(g)*d/Math.sin(b(Math.PI/2-l-g,.01,Math.PI-.01)),p=Math.sin(l)*m+d,w=10*d;return{fov:M,aspect:e/n,focalDistance:f,near:h,far:Math.min(p*u,w)}}function A(t){const{fov:e,aspect:n,near:i,far:a}=S(t);return u([],e,n,i,a)}function D(t){return 2*Math.atan(.5/t)*w}function B(t){return.5/Math.tan(.5*t*x)}function U(t,e){const[n,i,a=0]=t;return g(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a)),M(e,[n,i,a,1])}function _(t,e,n=0){const[a,o,r]=t;if(g(Number.isFinite(a)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(r)){return M(e,[a,o,r,1])}const s=M(e,[a,o,0,1]),h=M(e,[a,o,1,1]),u=s[2],c=h[2];return i([],s,h,u===c?0:((n||0)-u)/(c-u))}function O(t){const{width:e,height:n,bounds:i,minExtent:a=0,maxZoom:o=24,offset:r=[0,0]}=t,[[s,h],[u,c]]=i,M=function(t=0){if("number"==typeof t)return{top:t,bottom:t,left:t,right:t};return g(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t}(t.padding),l=L([s,b(c,-85.051129,v)]),f=L([u,b(h,-85.051129,v)]),m=[Math.max(Math.abs(f[0]-l[0]),a),Math.max(Math.abs(f[1]-l[1]),a)],p=[e-M.left-M.right-2*Math.abs(r[0]),n-M.top-M.bottom-2*Math.abs(r[1])];g(p[0]>0&&p[1]>0);const x=p[0]/m[0],w=p[1]/m[1],P=(M.right-M.left)/2/x,F=(M.top-M.bottom)/2/w,j=z([(f[0]+l[0])/2+P,(f[1]+l[1])/2+F]),y=Math.min(o,d(Math.abs(Math.min(x,w))));return g(Number.isFinite(y)),{longitude:j[0],latitude:j[1],zoom:y}}const E=Math.PI/180;function I(t,e=0){const{width:n,height:i,unproject:a}=t,o={targetZ:e},r=a([0,i],o),s=a([n,i],o);let h,u;return(t.fovy?.5*t.fovy*E:Math.atan(.5/t.altitude))>(90-t.pitch)*E-.01?(h=q(t,0,e),u=q(t,n,e)):(h=a([0,0],o),u=a([n,0],o)),[r,s,u,h]}function q(t,e,n){const{pixelUnprojectionMatrix:a}=t,o=M(a,[e,0,1,1]),r=M(a,[e,t.height,1,1]),s=z(i([],o,r,(n*t.distanceScales.unitsPerMeter[2]-o[2])/(r[2]-o[2])));return s.push(n),s}class C{constructor(t={width:1,height:1}){this.equals=t=>t instanceof C&&(t.width===this.width&&t.height===this.height&&c(t.projectionMatrix,this.projectionMatrix)&&c(t.viewMatrix,this.viewMatrix)),this.project=(t,e={})=>{const{topLeft:n=!0}=e,i=U(this.projectPosition(t),this.pixelProjectionMatrix),[a,o]=i,r=n?o:this.height-o;return 2===t.length?[a,r]:[a,r,i[2]]},this.unproject=(t,e={})=>{const{topLeft:n=!0,targetZ:i}=e,[a,o,r]=t,s=n?o:this.height-o,h=i&&i*this.distanceScales.unitsPerMeter[2],u=_([a,s,r],this.pixelUnprojectionMatrix,h),[c,M,l]=this.unprojectPosition(u);return Number.isFinite(r)?[c,M,l]:Number.isFinite(i)?[c,M,i]:[c,M]},this.projectPosition=t=>{const[e,n]=L(t);return[e,n,(t[2]||0)*this.distanceScales.unitsPerMeter[2]]},this.unprojectPosition=t=>{const[e,n]=z(t);return[e,n,(t[2]||0)*this.distanceScales.metersPerUnit[2]]};let{width:e,height:n,altitude:i=null,fovy:a=null}=t;const{latitude:r=0,longitude:s=0,zoom:h=0,pitch:u=0,bearing:M=0,position:l=null,nearZMultiplier:f=.02,farZMultiplier:b=1.01}=t;e=e||1,n=n||1,null===a&&null===i?(i=j,a=D(i)):null===a?a=D(i):null===i&&(i=B(a));const d=y(h);i=Math.max(.75,i);const g=T({longitude:s,latitude:r}),m=L([s,r]);var p,x,w;m.push(0),l&&(p=m,x=m,w=o([],l,g.unitsPerMeter),p[0]=x[0]+w[0],p[1]=x[1]+w[1],p[2]=x[2]+w[2]),this.projectionMatrix=A({width:e,height:n,scale:d,center:m,pitch:u,fovy:a,nearZMultiplier:f,farZMultiplier:b}),this.viewMatrix=Z({height:n,scale:d,center:m,pitch:u,bearing:M,altitude:i}),this.width=e,this.height=n,this.scale=d,this.latitude=r,this.longitude=s,this.zoom=h,this.pitch=u,this.bearing=M,this.altitude=i,this.fovy=a,this.center=m,this.meterOffset=l||[0,0,0],this.distanceScales=g,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:t,height:e,projectionMatrix:n,viewMatrix:i}=this,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];r(a,a,n),r(a,a,i),this.viewProjectionMatrix=a;const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];h(o,o,[t/2,-e/2,1]),s(o,o,[1,-1,0]),r(o,o,a);const u=function(t,e){const n=e[0],i=e[1],a=e[2],o=e[3],r=e[4],s=e[5],h=e[6],u=e[7],c=e[8],M=e[9],l=e[10],f=e[11],b=e[12],d=e[13],g=e[14],m=e[15],p=n*s-i*r,x=n*h-a*r,w=n*u-o*r,P=i*h-a*s,F=i*u-o*s,v=a*u-o*h,j=c*d-M*b,y=c*g-l*b,N=c*m-f*b,L=M*g-l*d,z=M*m-f*d,T=l*m-f*g;let Z=p*T-x*z+w*L+P*N-F*y+v*j;return Z?(Z=1/Z,t[0]=(s*T-h*z+u*L)*Z,t[1]=(a*z-i*T-o*L)*Z,t[2]=(d*v-g*F+m*P)*Z,t[3]=(l*F-M*v-f*P)*Z,t[4]=(h*N-r*T-u*y)*Z,t[5]=(n*T-a*N+o*y)*Z,t[6]=(g*w-b*v-m*x)*Z,t[7]=(c*v-l*w+f*x)*Z,t[8]=(r*z-s*N+u*j)*Z,t[9]=(i*N-n*z-o*j)*Z,t[10]=(b*F-d*w+m*p)*Z,t[11]=(M*w-c*F-f*p)*Z,t[12]=(s*y-r*L-h*j)*Z,t[13]=(n*L-i*y+a*j)*Z,t[14]=(d*x-b*P-g*p)*Z,t[15]=(c*P-M*x+l*p)*Z,t):null}([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o);if(!u)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=o,this.pixelUnprojectionMatrix=u}projectFlat(t){return L(t)}unprojectFlat(t){return z(t)}getMapCenterByLngLatPosition({lngLat:t,pos:e}){const i=_(e,this.pixelUnprojectionMatrix),a=n([],L(t),((o=[])[0]=-(r=i)[0],o[1]=-r[1],o));var o,r;return z(n([],this.center,a))}fitBounds(t,e={}){const{width:n,height:i}=this,{longitude:a,latitude:o,zoom:r}=O(Object.assign({width:n,height:i,bounds:t},e));return new C({width:n,height:i,longitude:a,latitude:o,zoom:r})}getBounds(t){const e=this.getBoundingRegion(t),n=Math.min(...e.map(t=>t[0])),i=Math.max(...e.map(t=>t[0]));return[[n,Math.min(...e.map(t=>t[1]))],[i,Math.max(...e.map(t=>t[1]))]]}getBoundingRegion(t={}){return I(this,t.z||0)}getLocationAtPoint({lngLat:t,pos:e}){return this.getMapCenterByLngLatPosition({lngLat:t,pos:e})}}const V=["longitude","latitude","zoom"],W={curve:1.414,speed:1.2};function X(t,e,n){const i=(n=Object.assign({},W,n)).curve,o=t.zoom,r=[t.longitude,t.latitude],s=y(o),h=e.zoom,u=[e.longitude,e.latitude],c=y(h-o),M=L(r),l=L(u),f=a([],l,M),b=Math.max(t.width,t.height),d=b/c,g=function(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}(f)*s,m=Math.max(g,.01),p=i*i,x=(d*d-b*b+p*p*m*m)/(2*b*p*m),w=(d*d-b*b-p*p*m*m)/(2*d*p*m),P=Math.log(Math.sqrt(x*x+1)-x),F=Math.log(Math.sqrt(w*w+1)-w);return{startZoom:o,startCenterXY:M,uDelta:f,w0:b,u1:g,S:(F-P)/i,rho:i,rho2:p,r0:P,r1:F}}var R=Object.freeze({__proto__:null,MAX_LATITUDE:v,WebMercatorViewport:C,addMetersToLngLat:function(t,e){const[n,i,a]=t,[o,r,s]=e,{unitsPerMeter:h,unitsPerMeter2:u}=T({longitude:n,latitude:i,highPrecision:!0}),c=L(t);c[0]+=o*(h[0]+u[0]*r),c[1]+=r*(h[1]+u[1]*r);const M=z(c),l=(a||0)+(s||0);return Number.isFinite(a)||Number.isFinite(s)?[M[0],M[1],l]:M},altitudeToFovy:D,default:C,fitBounds:O,flyToViewport:function(t,e,i,a){const{startZoom:o,startCenterXY:r,uDelta:s,w0:h,u1:u,S:c,rho:M,rho2:l,r0:b}=X(t,e,a);if(u<.01){const n={};for(const a of V){const o=t[a],r=e[a];n[a]=f(o,r,i)}return n}const d=i*c,g=Math.cosh(b)/Math.cosh(b+M*d),m=h*((Math.cosh(b)*Math.tanh(b+M*d)-Math.sinh(b))/l)/u,p=o+N(1/g),x=(F=m,(w=[])[0]=(P=s)[0]*F,w[1]=P[1]*F,w);var w,P,F;n(x,x,r);const v=z(x);return{longitude:v[0],latitude:v[1],zoom:p}},fovyToAltitude:B,getBounds:I,getDistanceScales:T,getFlyToDuration:function(t,e,n){const i={...W,...n},{screenSpeed:a,speed:o,maxDuration:r}=i,{S:s,rho:h}=X(t,e,i),u=1e3*s;let c;return c=Number.isFinite(a)?u/(a/h):u/o,Number.isFinite(r)&&c>r?0:c},getMeterZoom:function(t){const{latitude:e}=t;g(Number.isFinite(e));const n=Math.cos(e*x);return N(F*n)-9},getProjectionMatrix:A,getProjectionParameters:S,getViewMatrix:Z,lngLatToWorld:L,normalizeViewportProps:function(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:a,latitude:o,zoom:r,bearing:s=0}=t;(a<-180||a>180)&&(a=l(a+180,360)-180),(s<-180||s>180)&&(s=l(s+180,360)-180);const h=d(n/512);if(r<=h)r=h,o=0;else{const t=n/2/Math.pow(2,r),e=z([0,t])[1];if(o<e)o=e;else{const e=z([0,512-t])[1];o>e&&(o=e)}}return{width:e,height:n,longitude:a,latitude:o,zoom:r,pitch:i,bearing:s}},pixelsToWorld:_,scaleToZoom:N,unitsPerMeter:function(t){return 12790407194604047e-21/Math.cos(t*x)},worldToLngLat:z,worldToPixels:U,zoomToScale:y});return"undefined"!=typeof window&&(window.webMercator=R),R});
