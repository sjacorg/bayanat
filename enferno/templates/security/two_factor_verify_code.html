{% extends "login-layout.html" %} {% from "security/_macros.html" import prop_next,
render_field_with_errors, render_field %} {% block navbar %} {% endblock %} {% block content %}

<v-main class="d-flex flex-column align-center justify-center bg-background">
  <v-card class="login-card mx-auto pa-8 w-100" rounded="lg" style="max-width: 424px">
    <v-card-title class="login-title px-0 pb-0">{{ _("Authentication app") }}</v-card-title>
    <v-card-subtitle class="login-subtitle px-0 pb-4"
      >{{ _("Please enter your authentication code") }}</v-card-subtitle
    >
    <form
      action="{{ url_for_security('two_factor_token_validation') }}"
      method="POST"
      name="two_factor_verify_code_form"
      ref="twoFactorVerifyCodeFormRef"
    >
      {{ two_factor_verify_code_form.hidden_tag() }}
      <v-card-text class="pa-0">
        <label class="mb-n2 d-block">{{ _('Authentication code') }}</label>
        <v-otp-input autofocus name="code" max-width="100%" @finish="this.$nextTick(() => this.$refs.twoFactorVerifyCodeFormRef.submit())"></v-otp-input>
        <p class="text-caption text-medium-emphasis mb-6 mt-n2">
          {{ _('The authentication code consists of 6 digits and is generated within your Authenticator app.') }}
        </p>
      </v-card-text>

      {% if two_factor_verify_code_form.errors %}
      <v-card-text class="px-0 pt-0">
        <div class="error-messages">
          {% for field, errors in two_factor_verify_code_form.errors.items() %} {% for error in
          errors %}
          <v-alert color="error" variant="tonal">{{ error }}</v-alert>
          {% endfor %} {% endfor %}
        </div>
      </v-card-text>
      {% endif %}
    </form>
  </v-card>

  <div class="mt-6 w-100 d-flex justify-space-between" style="max-width: 424px">
    <v-btn
      href="{{ url_for_security('tf_select') }}{{ prop_next() }}"
      color="primary"
      variant="outlined"
      prepend-icon="mdi-chevron-left"
      >{{ _('Back') }}</v-btn
    >
    <v-btn href="{{ url_for_security('login') }}" color="error" variant="outlined"
      >{{ _('Log out') }}</v-btn
    >
  </div>
</v-main>

<v-card class="elevation-0 my-5 d-none" color="grey lighten-4">
  <v-card-text>
    <form
      action="{{ url_for_security('two_factor_rescue') }}"
      method="POST"
      name="two_factor_rescue_form"
    >
      {{ two_factor_rescue_form.hidden_tag() }} {{
      render_field_with_errors(two_factor_rescue_form.help_setup) }} {% if problem=="lost_device" %}
      <p>{{ _("The code for authentication was sent to your email address") }}</p>
      {% endif %} {% if problem=="no_mail_access" %}
      <p>{{ _("A mail was sent to us in order to reset your application account") }}</p>
      {% endif %}
      <v-btn color="primary" type="submit">{{ _("Submit") }}</v-btn>
    </form>
  </v-card-text>
</v-card>

{% endblock %}
